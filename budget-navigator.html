<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AW 预算导航器 (AW Budget Navigator) - Final Layout</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; margin: 0; padding: 20px; background-color: #f4f7f6; color: #333; }
        .container { 
            max-width: 1400px; 
            margin: auto; 
            background: #fff; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
            position: relative;
        }
        h1, h2, h4 { color: #005f73; margin: 0; }
        h1 { margin-bottom: 5px; }
        h4 { margin-top: 1.5em; margin-bottom: 0.5em; border-bottom: 1px solid #e9ecef; padding-bottom: 5px;}
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            border-bottom: 2px solid #e0e0e0;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .main-titles {
            flex-grow: 1;
        }
        .page-header h2 {
           border-bottom: none;
           padding-bottom: 0;
        }

        .controls { margin-bottom: 20px; display: flex; gap: 15px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; font-weight: bold; transition: background-color 0.3s; }
        #add-project-btn { background-color: #007bff; color: white; }
        #calculate-btn { background-color: #28a745; color: white; }
        #projects-container { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .project-card { border: 1px solid #ccc; border-radius: 8px; padding: 15px; background-color: #fdfdfd; box-shadow: 0 2px 4px rgba(0,0,0,0.05); position: relative; }
        .project-card h3 { margin-top: 0; color: #005f73; border-bottom: 1px solid #eee; padding-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
        .delete-btn {
            background: #dc3545; color: white; border: none; border-radius: 50%; width: 24px; height: 24px;
            font-size: 16px; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; line-height: 1;
        }
        .form-group { margin-bottom: 12px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; font-size: 14px; }
        .form-group select, .form-group input { width: 100%; padding: 8px; border-radius: 4px; border: 1px solid #ccc; box-sizing: border-box; }
        .radio-group label { display: inline-block; margin-right: 15px; font-weight: normal; }
        .radio-group input { width: auto; margin-right: 5px; }
        input:disabled { background-color: #e9ecef; cursor: not-allowed; }
        .hidden { display: none; }
        #results-container { overflow-x: auto; }
        .results-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        .results-table th, .results-table td { border: 1px solid #dee2e6; padding: 12px; text-align: left; vertical-align: middle; }
        .results-table thead { background-color: #005f73; color: white; }
        .total-row { font-weight: bold; background-color: #e9ecef !important; }
        .grand-total { background-color: #ffe8cc !important; font-size: 1.1em; }
        .sub-item-label { padding-left: 30px !important; }
        .sub-item-data { color: #004085; font-style: italic; text-align: right !important; }

        /* --- UPDATED STYLES FOR THE INFO TABLE --- */
        .info-table-container {
            width: 55%; /* Made wider to flatten the table */
            max-width: 700px; /* Adjusted max width */
            flex-shrink: 0;
            margin-left: 20px;
        }
        .info-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.75vw; /* Adjusted font size */
            background-color: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15);
        }
        .info-table th, .info-table td {
            border: 1px solid #888;
            padding: 4px;
            vertical-align: middle;
            text-align: center;
        }
        .info-table td.align-left {
            text-align: left;
        }
        .info-table th {
            font-weight: bold;
        }
        .bg-dark-blue { background-color: #005f73; color: white; }
        .bg-bright-blue { background-color: #29b6f6; }
        .bg-light-green { background-color: #c6efce; }
        .bg-light-peach { background-color: #ffebcc; }

        /* Media query for smaller screens */
        @media (max-width: 1400px) {
            .info-table { font-size: 10.5px; } /* Fallback to fixed font size on smaller screens */
        }
        @media (max-width: 1100px) {
            .page-header {
                flex-direction: column;
                align-items: stretch;
                border-bottom: none;
            }
            .info-table-container {
                width: 100%;
                max-width: none;
                margin-left: 0;
                margin-bottom: 20px;
                order: -1;
            }
            .main-titles {
                border-bottom: 2px solid #e0e0e0;
                padding-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">

        <div class="page-header">
            <div class="main-titles">
                <h1>AW 预算导航器 (AW Budget Navigator)</h1>
                <h2>输入参数</h2>
            </div>
            <div class="info-table-container">
                <table class="info-table">
                    <!-- --- NEW: <colgroup> to control column widths --- -->
                    <colgroup>
                        <col style="width: 35%;">
                        <col style="width: 15%;">
                        <col style="width: 12.5%;">
                        <col style="width: 12.5%;">
                        <col style="width: 12.5%;">
                        <col style="width: 12.5%;">
                    </colgroup>
                    <thead>
                        <tr>
                            <th rowspan="2" class="bg-dark-blue">Project Type</th>
                            <th rowspan="2" class="bg-dark-blue">AW Scale</th>
                            <th colspan="4" class="bg-dark-blue">Complexity</th>
                        </tr>
                        <tr>
                            <th class="bg-dark-blue">Graphic (Design)</th>
                            <th class="bg-dark-blue">TD (dimension)</th>
                            <th class="bg-dark-blue">LCS (LCS/ wording)</th>
                            <th class="bg-dark-blue">Tech Spec (FPC/ barcode/ one code)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="align-left">New Initiative</td>
                            <td>Scale A</td>
                            <td class="bg-light-peach">New</td>
                            <td class="bg-light-peach">New/Existing</td>
                            <td class="bg-light-peach">New</td>
                            <td class="bg-light-peach">New</td>
                        </tr>
                        <tr>
                            <td rowspan="2" class="align-left">Line extension (based on existing SKU create new variant , share the same deign system), cost saving, sourcing extension, etc.</td>
                            <td rowspan="2">Scale B</td>
                            <td class="bg-light-green">Graphic extension</td>
                            <td class="bg-light-green">existing</td>
                            <td class="bg-bright-blue">New/existing</td>
                            <td class="bg-light-peach">New</td>
                        </tr>
                         <tr>
                            <td class="bg-light-green">existing</td>
                            <td class="bg-light-peach">New</td>
                            <td class="bg-bright-blue">New/existing</td>
                            <td class="bg-light-peach">New</td>
                        </tr>
                        <tr>
                            <td class="align-left">Customization, Promotion pack</td>
                            <td>Scale C</td>
                            <td class="bg-light-green">existing</td>
                            <td class="bg-light-green">existing</td>
                            <td class="bg-light-peach">New</td>
                            <td class="bg-light-peach">New</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <div class="controls"><button id="add-project-btn">添加新项目</button><button id="calculate-btn">计算总成本</button></div>
        <div id="projects-container"></div>
        <h2 id="results-title" style="display:none;">估算成本 ($m)</h2>
        <div id="results-container"></div>
    </div>

    <template id="project-template">
        <div class="project-card">
            <h3><span class="project-title">项目</span><button class="delete-btn" title="删除此项目">X</button></h3>
            <div class="form-group"><label>Main POA#</label><input type="number" class="main-poa" value="0" min="0"></div>
            <div class="form-group"><label>Package type</label><select class="package-type"></select></div>
            <div class="form-group"><label>Scale</label><select class="scale"><option value="A">A</option><option value="B">B</option><option value="C">C</option></select></div>
            <hr><h4>SRA</h4>
            <div class="form-group"><label>Print trial or not?</label><div class="radio-group"><label><input type="radio" class="print-trial-option" name="print-trial-option" value="No" checked> No</label><label><input type="radio" class="print-trial-option" name="print-trial-option" value="Yes"> Yes</label></div></div>
            <div class="form-group"><label>Print trial POA#</label><input type="number" class="print-trial-poa" value="0" min="0" disabled></div>
            <hr><h4>GMC</h4>
            <div class="form-group"><label>New color for IDD or not?</label><div class="radio-group"><label><input type="radio" class="new-color-option" name="new-color-option" value="No" checked> No</label><label><input type="radio" class="new-color-option" name="new-color-option" value="Yes"> Yes</label></div></div>
            <div class="form-group"><label>New color#</label><input type="number" class="new-color-num" value="0" min="0" disabled></div>
            <div class="form-group"><label>BCP supplier?</label><div class="radio-group"><label><input type="radio" class="bcp-supplier-option" name="bcp-supplier-option" value="No" checked> No</label><label><input type="radio" class="bcp-supplier-option" name="bcp-supplier-option" value="Yes"> Yes</label></div></div>
            <div class="form-group"><label>BCP POA#</label><input type="number" class="bcp-poa" value="0" min="0" disabled></div>
        </div>
    </template>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const SRA_DIVISOR = 7256;
    const GMC_DIVISOR = 7263;

    const packageTypes = [ "Pouch", "Film", "Sachet", "Poly bag", "Label", "Sticker", "Shrink sleeve", "Blister card", "Color shipper/Hub", "PDQ", "Woven bag", "Brown shipper/Tray" ];
    
    const unitCosts = {
        SRA_AW: { 'Pouch':{A:10906,B:10106,C:4657}, 'Film':{A:10906,B:10106,C:4657}, 'Sachet':{A:10826,B:10106,C:4460}, 'Poly bag':{A:10826,B:10106,C:4460}, 'Label':{A:10826,B:10106,C:4460}, 'Sticker':{A:10599,B:9799,C:4278}, 'Shrink sleeve':{A:11475,B:10675,C:5387}, 'Blister card':{A:10599,B:9799,C:4278}, 'Color shipper/Hub':{A:5400,B:4600,C:1500}, 'PDQ':{A:5400,B:4600,C:1500}, 'Woven bag':{A:5400,B:4600,C:1500}, 'Brown shipper/Tray':{A:1900,B:900,C:400} },
        SRA_PrintTrial: { 'Pouch': 14540, 'Film': 14540, 'Sachet': 14540, 'Poly bag': 14540, 'Label': 9500, 'Sticker': 9500, 'Shrink sleeve': 12900, 'Blister card': 12000, 'Color shipper/Hub': 19400, 'PDQ': 19400, 'Woven bag': 0, 'Brown shipper/Tray': 0 },
        GMC_Print_per_POA: { 'Pouch': 11540, 'Film': 11540, 'Sachet': 11540, 'Poly bag': 11540, 'Label': 3500, 'Sticker': 3500, 'Shrink sleeve': 6900, 'Blister card': 0, 'Color shipper/Hub': 0, 'PDQ': 0, 'Woven bag': 7000, 'Brown shipper/Tray': 0 },
        GMC_IDD_per_Color: { 'Pouch': 2000, 'Film': 2000, 'Sachet': 2000, 'Poly bag': 2000, 'Label': 0, 'Sticker': 0, 'Shrink sleeve': 0, 'Blister card': 0, 'Color shipper/Hub': 0, 'PDQ': 0, 'Woven bag': 0, 'Brown shipper/Tray': 0 },
        GMC_BCP_per_POA: { 'Pouch': 3000, 'Film': 3000, 'Sachet': 3000, 'Poly bag': 3000, 'Label': 6000, 'Sticker': 6000, 'Shrink sleeve': 6000, 'Blister card': 7200, 'Color shipper/Hub': 7200, 'PDQ': 7200, 'Woven bag': 0, 'Brown shipper/Tray': 0 }
    };
    
    const addProjectBtn = document.getElementById('add-project-btn'), calculateBtn = document.getElementById('calculate-btn');
    const projectsContainer = document.getElementById('projects-container'), projectTemplate = document.getElementById('project-template');
    let projectCounter = 0;

    function addProject() {
        projectCounter++;
        const clone = projectTemplate.content.cloneNode(true), card = clone.querySelector('.project-card');
        card.dataset.projectId = projectCounter;
        
        const packageTypeSelect = card.querySelector('.package-type');
        packageTypes.forEach(type => packageTypeSelect.add(new Option(type, type)));
        
        card.querySelector('h3 > .project-title').textContent = packageTypeSelect.value;
        
        card.querySelectorAll('input[type="radio"]').forEach(r => r.name += `-${projectCounter}`);
        addEventListenersToCard(card);
        projectsContainer.appendChild(clone);
    }
    
    function addEventListenersToCard(card) {
        card.querySelector('.package-type').addEventListener('change', function() {
            card.querySelector('h3 > .project-title').textContent = this.value;
        });

        const toggleInput = (radioName, inputSelector) => {
            const input = card.querySelector(inputSelector);
            card.querySelectorAll(`input[name="${radioName}"]`).forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'Yes' && this.checked) {
                        input.disabled = false;
                    } else if (this.value === 'No' && this.checked) {
                        input.disabled = true;
                        input.value = 0;
                    }
                });
            });
        };
        toggleInput(card.querySelector('.print-trial-option').name, '.print-trial-poa');
        toggleInput(card.querySelector('.new-color-option').name, '.new-color-num');
        toggleInput(card.querySelector('.bcp-supplier-option').name, '.bcp-poa');
        card.querySelector('.delete-btn').addEventListener('click', () => { card.remove(); });
    }
    
    function calculateCosts() {
        if (projectsContainer.childElementCount === 0) { alert("请先添加至少一个项目。"); return; }
        const results = [];
        projectsContainer.querySelectorAll('.project-card').forEach(card => {
            const mainPoa = parseFloat(card.querySelector('.main-poa').value) || 0;
            const pkgType = card.querySelector('.package-type').value;
            const scale = card.querySelector('.scale').value;
            const ptPoa = parseFloat(card.querySelector('.print-trial-poa').value) || 0;
            const newColorNum = parseFloat(card.querySelector('.new-color-num').value) || 0;
            const bcpPoa = parseFloat(card.querySelector('.bcp-poa').value) || 0;

            const unit_aw_rmb = unitCosts.SRA_AW[pkgType]?.[scale] ?? 0;
            const unit_pt_rmb = unitCosts.SRA_PrintTrial[pkgType] ?? 0;
            const awCost = (mainPoa * unit_aw_rmb) / SRA_DIVISOR;
            const printTrialCost = (ptPoa * unit_pt_rmb) / SRA_DIVISOR;
            const sraCost = awCost + printTrialCost;

            const unit_gmc_print_rmb = unitCosts.GMC_Print_per_POA[pkgType] ?? 0;
            const unit_gmc_idd_rmb = unitCosts.GMC_IDD_per_Color[pkgType] ?? 0;
            const unit_gmc_bcp_rmb = unitCosts.GMC_BCP_per_POA[pkgType] ?? 0;
            const gmcPrintCost = (mainPoa * unit_gmc_print_rmb) / GMC_DIVISOR;
            const gmcIddCost = (newColorNum * unit_gmc_idd_rmb) / GMC_DIVISOR;
            const gmcBcpCost = (bcpPoa * unit_gmc_bcp_rmb) / GMC_DIVISOR;
            const gmcCost = gmcPrintCost + gmcIddCost + gmcBcpCost;
            
            const totalCost = sraCost + gmcCost;
            
            results.push({ pkgType, sraCost, printTrialCost, awCost, gmcCost, totalCost });
        });
        displayResults(results);
    }

    function displayResults(results) {
        const resultsContainer = document.getElementById('results-container'), resultsTitle = document.getElementById('results-title');
        resultsContainer.innerHTML = '';
        if (results.length === 0) { resultsTitle.style.display = 'none'; return; }
        
        resultsTitle.style.display = 'block';
        const table = document.createElement('table');
        table.className = 'results-table'; // Add class to distinguish from info-table
        let headerRow = '<tr><th>Estimate cost($m)</th>';
        
        results.forEach(res => headerRow += `<th>${res.pkgType}</th>`);
        
        headerRow += '<th>总计 (Sum -$m)</th></tr>';
        table.innerHTML = `<thead>${headerRow}</thead>`;
        const costRows = [ { label: 'SRA', key: 'sraCost' }, { label: 'Print trial', key: 'printTrialCost', isSub: true }, { label: 'AW', key: 'awCost', isSub: true }, { label: 'GMC', key: 'gmcCost' }, { label: 'Total', key: 'totalCost', isTotal: true }, ];
        const grandTotals = {};
        costRows.forEach(row => grandTotals[row.key] = 0);
        results.forEach(res => costRows.forEach(row => grandTotals[row.key] += res[row.key]));
        const tbody = document.createElement('tbody');
        costRows.forEach(rowInfo => {
            const row = tbody.insertRow(); if (rowInfo.isTotal) row.classList.add('total-row');
            const labelCell = row.insertCell(); labelCell.textContent = rowInfo.label; if (rowInfo.isSub) labelCell.classList.add('sub-item-label');
            results.forEach(res => { 
                const dataCell = row.insertCell(); 
                dataCell.textContent = res[rowInfo.key].toFixed(1); 
                if (rowInfo.isSub) dataCell.classList.add('sub-item-data'); 
            });
            const totalCell = row.insertCell(); 
            totalCell.textContent = grandTotals[rowInfo.key].toFixed(1); 
            if (rowInfo.isSub) totalCell.classList.add('sub-item-data'); 
            if (rowInfo.isTotal) totalCell.classList.add('grand-total');
        });
        table.appendChild(tbody); resultsContainer.appendChild(table);
    }
    
    addProjectBtn.addEventListener('click', addProject);
    calculateBtn.addEventListener('click', calculateCosts);
    addProject();
});
</script>

</body>
</html>